#include <errno.h>

BEGIN
{
    @errno[1]   = 1; // EPERM         - Operation not permitted
    @errno[2]   = 1; // ENOENT        - No such file or directory
    @errno[3]   = 1; // ESRCH         - No such process
    @errno[4]   = 1; // EINTR         - Interrupted system call
    @errno[5]   = 1; // EIO           - I/O error
    @errno[6]   = 1; // ENXIO         - No such device or address
    @errno[7]   = 1; // E2BIG         - Argument list too long
    @errno[8]   = 1; // ENOEXEC       - Exec format error
    @errno[9]   = 1; // EBADF         - Bad file number
    @errno[10]  = 1; // ECHILD        - No child processes
    @errno[11]  = 1; // EAGAIN        - Try again (Resource temporarily unavailable)
                    // (EWOULDBLOCK is often an alias for EAGAIN with the same value)
    @errno[12]  = 1; // ENOMEM        - Out of memory
    @errno[13]  = 1; // EACCES        - Permission denied
    @errno[14]  = 1; // EFAULT        - Bad address
    @errno[15]  = 1; // ENOTBLK       - Block device required
    @errno[16]  = 1; // EBUSY         - Device or resource busy
    @errno[17]  = 1; // EEXIST        - File exists
    @errno[18]  = 1; // EXDEV         - Cross-device link
    @errno[19]  = 1; // ENODEV        - No such device
    @errno[20]  = 1; // ENOTDIR       - Not a directory
    @errno[21]  = 1; // EISDIR        - Is a directory
    @errno[22]  = 1; // EINVAL        - Invalid argument
    @errno[23]  = 1; // ENFILE        - File table overflow (System-wide limit)
    @errno[24]  = 1; // EMFILE        - Too many open files (Per-process limit)
    @errno[25]  = 1; // ENOTTY        - Not a typewriter (Inappropriate ioctl for device)
    @errno[26]  = 1; // ETXTBSY       - Text file busy
    @errno[27]  = 1; // EFBIG         - File too large
    @errno[28]  = 1; // ENOSPC        - No space left on device
    @errno[29]  = 1; // ESPIPE        - Illegal seek
    @errno[30]  = 1; // EROFS         - Read-only file system
    @errno[31]  = 1; // EMLINK        - Too many links
    @errno[32]  = 1; // EPIPE         - Broken pipe
    @errno[33]  = 1; // EDOM          - Math argument out of domain of func
    @errno[34]  = 1; // ERANGE        - Math result not representable
    @errno[35]  = 1; // EDEADLK       - Resource deadlock would occur (may be EDEADLOCK)
    @errno[36]  = 1; // ENAMETOOLONG  - File name too long
    @errno[37]  = 1; // ENOLCK        - No record locks available
    @errno[38]  = 1; // ENOSYS        - Function not implemented / Invalid system call
    @errno[39]  = 1; // ENOTEMPTY     - Directory not empty
    @errno[40]  = 1; // ELOOP         - Too many symbolic links encountered
    // @errno[41] is typically not used for EWOULDBLOCK if 11 is EAGAIN/EWOULDBLOCK
    @errno[42]  = 1; // ENOMSG        - No message of desired type
    @errno[43]  = 1; // EIDRM         - Identifier removed
    @errno[44]  = 1; // ECHRNG        - Channel number out of range (STREAMS)
    @errno[45]  = 1; // EL2NSYNC      - Level 2 not synchronized (STREAMS)
    @errno[46]  = 1; // EL3HLT        - Level 3 halted (STREAMS)
    @errno[47]  = 1; // EL3RST        - Level 3 reset (STREAMS)
    @errno[48]  = 1; // ELNRNG        - Link number out of range (STREAMS)
    @errno[49]  = 1; // EUNATCH       - Protocol driver not attached (STREAMS)
    @errno[50]  = 1; // ENOCSI        - No CSI structure available (STREAMS)
    @errno[51]  = 1; // EL2HLT        - Level 2 halted (STREAMS)
    @errno[52]  = 1; // EBADE         - Invalid exchange (STREAMS)
    @errno[53]  = 1; // EBADR         - Invalid request descriptor (STREAMS)
    @errno[54]  = 1; // EXFULL        - Exchange full (STREAMS)
    @errno[55]  = 1; // ENOANO        - No anode (STREAMS)
    @errno[56]  = 1; // EBADRQC       - Invalid request code (STREAMS)
    @errno[57]  = 1; // EBADSLT       - Invalid slot (STREAMS)
    // @errno[58] - EDEADLOCK often alias for EDEADLK (35)
    @errno[59]  = 1; // EBFONT        - Bad font file format
    @errno[60]  = 1; // ENOSTR        - Device not a stream
    @errno[61]  = 1; // ENODATA       - No data available (STREAMS)
    @errno[62]  = 1; // ETIME         - Timer expired (STREAMS)
    @errno[63]  = 1; // ENOSR         - Out of streams resources (STREAMS)
    @errno[64]  = 1; // ENONET        - Machine is not on the network (STREAMS)
    @errno[65]  = 1; // ENOPKG        - Package not installed (STREAMS)
    @errno[66]  = 1; // EREMOTE       - Object is remote (STREAMS)
    @errno[67]  = 1; // ENOLINK       - Link has been severed (STREAMS)
    @errno[68]  = 1; // EADV          - Advertise error (STREAMS)
    @errno[69]  = 1; // ESRMNT        - Srmount error (STREAMS)
    @errno[70]  = 1; // ECOMM         - Communication error on send (STREAMS)
    @errno[71]  = 1; // EPROTO        - Protocol error
    @errno[72]  = 1; // EMULTIHOP     - Multihop attempted (STREAMS)
    @errno[73]  = 1; // EDOTDOT       - RFS specific error (STREAMS)
    @errno[74]  = 1; // EBADMSG       - Not a data message (Bad message)
    @errno[75]  = 1; // EOVERFLOW     - Value too large for defined data type
    @errno[76]  = 1; // ENOTUNIQ      - Name not unique on network (STREAMS)
    @errno[77]  = 1; // EBADFD        - File descriptor in bad state (STREAMS)
    @errno[78]  = 1; // EREMCHG       - Remote address changed (STREAMS)
    @errno[79]  = 1; // ELIBACC       - Can not access a needed shared library
    @errno[80]  = 1; // ELIBBAD       - Accessing a corrupted shared library
    @errno[81]  = 1; // ELIBSCN       - .lib section in a.out corrupted
    @errno[82]  = 1; // ELIBMAX       - Attempting to link in too many shared libraries
    @errno[83]  = 1; // ELIBEXEC      - Cannot exec a shared library directly
    @errno[84]  = 1; // EILSEQ        - Illegal byte sequence (Invalid or incomplete multibyte or wide character)
    @errno[85]  = 1; // ERESTART      - Interrupted system call should be restarted
    @errno[86]  = 1; // ESTRPIPE      - Streams pipe error (STREAMS)
    @errno[87]  = 1; // EUSERS        - Too many users
    @errno[88]  = 1; // ENOTSOCK      - Socket operation on non-socket
    @errno[89]  = 1; // EDESTADDRREQ  - Destination address required
    @errno[90]  = 1; // EMSGSIZE      - Message too long
    @errno[91]  = 1; // EPROTOTYPE    - Protocol wrong type for socket
    @errno[92]  = 1; // ENOPROTOOPT   - Protocol not available
    @errno[93]  = 1; // EPROTONOSUPPORT - Protocol not supported
    @errno[94]  = 1; // ESOCKTNOSUPPORT - Socket type not supported
    @errno[95]  = 1; // EOPNOTSUPP    - Operation not supported on transport endpoint (may be ENOTSUP)
    @errno[96]  = 1; // EPFNOSUPPORT  - Protocol family not supported
    @errno[97]  = 1; // EAFNOSUPPORT  - Address family not supported by protocol
    @errno[98]  = 1; // EADDRINUSE    - Address already in use
    @errno[99]  = 1; // EADDRNOTAVAIL - Cannot assign requested address
    @errno[100] = 1; // ENETDOWN      - Network is down
    @errno[101] = 1; // ENETUNREACH   - Network is unreachable
    @errno[102] = 1; // ENETRESET     - Network dropped connection because of reset
    @errno[103] = 1; // ECONNABORTED  - Software caused connection abort
    @errno[104] = 1; // ECONNRESET    - Connection reset by peer
    @errno[105] = 1; // ENOBUFS       - No buffer space available
    @errno[106] = 1; // EISCONN       - Transport endpoint is already connected
    @errno[107] = 1; // ENOTCONN      - Transport endpoint is not connected
    @errno[108] = 1; // ESHUTDOWN     - Cannot send after transport endpoint shutdown
    @errno[109] = 1; // ETOOMANYREFS  - Too many references: cannot splice
    @errno[110] = 1; // ETIMEDOUT     - Connection timed out
    @errno[111] = 1; // ECONNREFUSED  - Connection refused
    @errno[112] = 1; // EHOSTDOWN     - Host is down
    @errno[113] = 1; // EHOSTUNREACH  - No route to host
    @errno[114] = 1; // EALREADY      - Operation already in progress
    @errno[115] = 1; // EINPROGRESS   - Operation now in progress
    @errno[116] = 1; // ESTALE        - Stale file handle (e.g., NFS)
    @errno[117] = 1; // EUCLEAN       - Structure needs cleaning (internal, e.g. AFS)
    @errno[118] = 1; // ENOTNAM       - Not a XENIX named type file (internal, e.g. AFS)
    @errno[119] = 1; // ENAVAIL       - No XENIX semaphores available (internal, e.g. AFS)
    @errno[120] = 1; // EISNAM        - Is a named type file (internal, e.g. AFS)
    @errno[121] = 1; // EREMOTEIO     - Remote I/O error (internal, e.g. AFS)
    @errno[122] = 1; // EDQUOT        - Quota exceeded
    @errno[123] = 1; // ENOMEDIUM     - No medium found
    @errno[124] = 1; // EMEDIUMTYPE   - Wrong medium type
    @errno[125] = 1; // ECANCELED     - Operation Canceled
    @errno[126] = 1; // ENOKEY        - Required key not available
    @errno[127] = 1; // EKEYEXPIRED   - Key has expired
    @errno[128] = 1; // EKEYREVOKED   - Key has been revoked
    @errno[129] = 1; // EKEYREJECTED  - Key was rejected by service
    @errno[130] = 1; // EOWNERDEAD    - Owner died (for robust mutexes)
    @errno[131] = 1; // ENOTRECOVERABLE - State not recoverable (for robust mutexes)
    @errno[132] = 1; // ERFKILL       - Operation not possible due to RF-kill
    @errno[133] = 1; // EHWPOISON     - Memory page has hardware error
    @name[0] = "read";
    @name[1] = "write";
    @name[2] = "open";
    @name[3] = "close";
    @name[4] = "stat";
    @name[5] = "fstat";
    @name[6] = "lstat";
    @name[7] = "poll";
    @name[8] = "lseek";
    @name[9] = "mmap";
    @name[10] = "mprotect";
    @name[11] = "munmap";
    @name[12] = "brk";
    @name[13] = "rt_sigaction";
    @name[14] = "rt_sigprocmask";
    @name[15] = "rt_sigreturn";
    @name[16] = "ioctl";
    @name[17] = "pread";
    @name[18] = "pwrite";
    @name[19] = "readv";
    @name[20] = "writev";
    @name[21] = "access";
    @name[22] = "pipe";
    @name[23] = "select";
    @name[24] = "sched_yield";
    @name[25] = "mremap";
    @name[26] = "msync";
    @name[27] = "mincore";
    @name[28] = "madvise";
    @name[29] = "shmget";
    @name[30] = "shmat";
    @name[31] = "shmctl";
    @name[32] = "dup";
    @name[33] = "dup2";
    @name[34] = "pause";
    @name[35] = "nanosleep";
    @name[36] = "getitimer";
    @name[37] = "alarm";
    @name[38] = "setitimer";
    @name[39] = "getpid";
    @name[40] = "sendfile";
    @name[41] = "socket";
    @name[42] = "connect";
    @name[43] = "accept";
    @name[44] = "sendto";
    @name[45] = "recvfrom";
    @name[46] = "sendmsg";
    @name[47] = "recvmsg";
    @name[48] = "shutdown";
    @name[49] = "bind";
    @name[50] = "listen";
    @name[51] = "getsockname";
    @name[52] = "getpeername";
    @name[53] = "socketpair";
    @name[54] = "setsockopt";
    @name[55] = "getsockopt";
    @name[56] = "clone";
    @name[57] = "fork";
    @name[58] = "vfork";
    @name[59] = "execve";
    @name[60] = "exit";
    @name[61] = "wait4";
    @name[62] = "kill";
    @name[63] = "uname";
    @name[64] = "semget";
    @name[65] = "semop";
    @name[66] = "semctl";
    @name[67] = "shmdt";
    @name[68] = "msgget";
    @name[69] = "msgsnd";
    @name[70] = "msgrcv";
    @name[71] = "msgctl";
    @name[72] = "fcntl";
    @name[73] = "flock";
    @name[74] = "fsync";
    @name[75] = "fdatasync";
    @name[76] = "truncate";
    @name[77] = "ftruncate";
    @name[78] = "getdents";
    @name[79] = "getcwd";
    @name[80] = "chdir";
    @name[81] = "fchdir";
    @name[82] = "rename";
    @name[83] = "mkdir";
    @name[84] = "rmdir";
    @name[85] = "creat";
    @name[86] = "link";
    @name[87] = "unlink";
    @name[88] = "symlink";
    @name[89] = "readlink";
    @name[90] = "chmod";
    @name[91] = "fchmod";
    @name[92] = "chown";
    @name[93] = "fchown";
    @name[94] = "lchown";
    @name[95] = "umask";
    @name[96] = "gettimeofday";
    @name[97] = "getrlimit";
    @name[98] = "getrusage";
    @name[99] = "sysinfo";
    @name[100] = "times";
    @name[101] = "ptrace";
    @name[102] = "getuid";
    @name[103] = "syslog";
    @name[104] = "getgid";
    @name[105] = "setuid";
    @name[106] = "setgid";
    @name[107] = "geteuid";
    @name[108] = "getegid";
    @name[109] = "setpgid";
    @name[110] = "getppid";
    @name[111] = "getpgrp";
    @name[112] = "setsid";
    @name[113] = "setreuid";
    @name[114] = "setregid";
    @name[115] = "getgroups";
    @name[116] = "setgroups";
    @name[117] = "setresuid";
    @name[118] = "getresuid";
    @name[119] = "setresgid";
    @name[120] = "getresgid";
    @name[121] = "getpgid";
    @name[122] = "setfsuid";
    @name[123] = "setfsgid";
    @name[124] = "getsid";
    @name[125] = "capget";
    @name[126] = "capset";
    @name[127] = "rt_sigpending";
    @name[128] = "rt_sigtimedwait";
    @name[129] = "rt_sigqueueinfo";
    @name[130] = "rt_sigsuspend";
    @name[131] = "sigaltstack";
    @name[132] = "utime";
    @name[133] = "mknod";
    @name[134] = "uselib";
    @name[135] = "personality";
    @name[136] = "ustat";
    @name[137] = "statfs";
    @name[138] = "fstatfs";
    @name[139] = "sysfs";
    @name[140] = "getpriority";
    @name[141] = "setpriority";
    @name[142] = "sched_setparam";
    @name[143] = "sched_getparam";
    @name[144] = "sched_setscheduler";
    @name[145] = "sched_getscheduler";
    @name[146] = "sched_get_priority_max";
    @name[147] = "sched_get_priority_min";
    @name[148] = "sched_rr_get_interval";
    @name[149] = "mlock";
    @name[150] = "munlock";
    @name[151] = "mlockall";
    @name[152] = "munlockall";
    @name[153] = "vhangup";
    @name[154] = "modify_ldt";
    @name[155] = "pivot_root";
    @name[156] = "_sysctl";
    @name[157] = "prctl";
    @name[158] = "arch_prctl";
    @name[159] = "adjtimex";
    @name[160] = "setrlimit";
    @name[161] = "chroot";
    @name[162] = "sync";
    @name[163] = "acct";
    @name[164] = "settimeofday";
    @name[165] = "mount";
    @name[166] = "umount2";
    @name[167] = "swapon";
    @name[168] = "swapoff";
    @name[169] = "reboot";
    @name[170] = "sethostname";
    @name[171] = "setdomainname";
    @name[172] = "iopl";
    @name[173] = "ioperm";
    @name[174] = "create_module";
    @name[175] = "init_module";
    @name[176] = "delete_module";
    @name[177] = "get_kernel_syms";
    @name[178] = "query_module";
    @name[179] = "quotactl";
    @name[180] = "nfsservctl";
    @name[181] = "getpmsg";
    @name[182] = "putpmsg";
    @name[183] = "afs_syscall";
    @name[184] = "tuxcall";
    @name[185] = "security";
    @name[186] = "gettid";
    @name[187] = "readahead";
    @name[188] = "setxattr";
    @name[189] = "lsetxattr";
    @name[190] = "fsetxattr";
    @name[191] = "getxattr";
    @name[192] = "lgetxattr";
    @name[193] = "fgetxattr";
    @name[194] = "listxattr";
    @name[195] = "llistxattr";
    @name[196] = "flistxattr";
    @name[197] = "removexattr";
    @name[198] = "lremovexattr";
    @name[199] = "fremovexattr";
    @name[200] = "tkill";
    @name[201] = "time";
    @name[202] = "futex";
    @name[203] = "sched_setaffinity";
    @name[204] = "sched_getaffinity";
    @name[205] = "set_thread_area";
    @name[206] = "io_setup";
    @name[207] = "io_destroy";
    @name[208] = "io_getevents";
    @name[209] = "io_submit";
    @name[210] = "io_cancel";
    @name[211] = "get_thread_area";
    @name[212] = "lookup_dcookie";
    @name[213] = "epoll_create";
    @name[214] = "epoll_ctl_old";
    @name[215] = "epoll_wait_old";
    @name[216] = "remap_file_pages";
    @name[217] = "getdents64";
    @name[218] = "set_tid_address";
    @name[219] = "restart_syscall";
    @name[220] = "semtimedop";
    @name[221] = "fadvise64";
    @name[222] = "timer_create";
    @name[223] = "timer_settime";
    @name[224] = "timer_gettime";
    @name[225] = "timer_getoverrun";
    @name[226] = "timer_delete";
    @name[227] = "clock_settime";
    @name[228] = "clock_gettime";
    @name[229] = "clock_getres";
    @name[230] = "clock_nanosleep";
    @name[231] = "exit_group";
    @name[232] = "epoll_wait";
    @name[233] = "epoll_ctl";
    @name[234] = "tgkill";
    @name[235] = "utimes";
    @name[236] = "vserver";
    @name[237] = "mbind";
    @name[238] = "set_mempolicy";
    @name[239] = "get_mempolicy";
    @name[240] = "mq_open";
    @name[241] = "mq_unlink";
    @name[242] = "mq_timedsend";
    @name[243] = "mq_timedreceive";
    @name[244] = "mq_notify";
    @name[245] = "mq_getsetattr";
    @name[246] = "kexec_load";
    @name[247] = "waitid";
    @name[248] = "add_key";
    @name[249] = "request_key";
    @name[250] = "keyctl";
    @name[251] = "ioprio_set";
    @name[252] = "ioprio_get";
    @name[253] = "inotify_init";
    @name[254] = "inotify_add_watch";
    @name[255] = "inotify_rm_watch";
    @name[256] = "migrate_pages";
    @name[257] = "openat";
    @name[258] = "mkdirat";
    @name[259] = "mknodat";
    @name[260] = "fchownat";
    @name[261] = "futimesat";
    @name[262] = "newfstatat";
    @name[263] = "unlinkat";
    @name[264] = "renameat";
    @name[265] = "linkat";
    @name[266] = "symlinkat";
    @name[267] = "readlinkat";
    @name[268] = "fchmodat";
    @name[269] = "faccessat";
    @name[270] = "pselect6";
    @name[271] = "ppoll";
    @name[272] = "unshare";
    @name[273] = "set_robust_list";
    @name[274] = "get_robust_list";
    @name[275] = "splice";
    @name[276] = "tee";
    @name[277] = "sync_file_range";
    @name[278] = "vmsplice";
    @name[279] = "move_pages";
    @name[280] = "utimensat";
    @name[281] = "epoll_pwait";
    @name[282] = "signalfd";
    @name[283] = "timerfd";
    @name[284] = "eventfd";
    @name[285] = "fallocate";
    @name[286] = "timerfd_settime";
    @name[287] = "timerfd_gettime";
    @name[288] = "accept4";
    @name[289] = "signalfd4";
    @name[290] = "eventfd2";
    @name[291] = "epoll_create1";
    @name[292] = "dup3";
    @name[293] = "pipe2";
    @name[294] = "inotify_init1";
    @name[295] = "preadv";
    @name[296] = "pwritev";
    @name[297] = "rt_tgsigqueueinfo";
    @name[298] = "perf_event_open";
    @name[299] = "recvmmsg";
    @name[300] = "fanotify_init";
    @name[301] = "fanotify_mark";
    @name[302] = "prlimit64";
    @name[303] = "name_to_handle_at";
    @name[304] = "open_by_handle_at";
    @name[305] = "clock_adjtime";
    @name[306] = "syncfs";
    @name[307] = "sendmmsg";
    @name[308] = "setns";
    @name[309] = "getcpu";
    @name[310] = "process_vm_readv";
    @name[311] = "process_vm_writev";
    @name[312] = "kcmp";
    @name[313] = "finit_module";
    @name[314] = "sched_setattr";
    @name[315] = "sched_getattr";
    @name[316] = "renameat2";
    @name[317] = "seccomp";
    @name[318] = "getrandom";
    @name[319] = "memfd_create";
    @name[320] = "kexec_file_load";
    @name[321] = "bpf";
    @name[322] = "execveat";
    @name[323] = "userfaultfd";
    @name[324] = "membarrier";
    @name[325] = "mlock2";
    @name[326] = "copy_file_range";
    @name[327] = "preadv2";
    @name[328] = "pwritev2";
    @name[329] = "pkey_mprotect";
    @name[330] = "pkey_alloc";
    @name[331] = "pkey_free";
    @name[332] = "statx";
    @name[333] = "io_pgetevents";
    @name[334] = "rseq";

}

tracepoint:raw_syscalls:sys_enter
{
    @nr[tid] = args->id;
    @a0[tid] = args->args[0];
    @a1[tid] = args->args[1];
    @a2[tid] = args->args[2];
    @a3[tid] = args->args[3];
    @a4[tid] = args->args[4];
    @a5[tid] = args->args[5];
}

tracepoint:raw_syscalls:sys_exit /@errno[-args->ret] && comm == "exploit"/
{
        $nr = @nr[tid];
        $s = "unknown";
        if (@name[$nr] != "") {
            $s = @name[$nr];
        }

        printf("%-16s %-18s errno=%d args=[0x%lx 0x%lx 0x%lx 0x%lx 0x%lx 0x%lx]\n",
               comm, $s, -args->ret,
               @a0[tid], @a1[tid], @a2[tid],
               @a3[tid], @a4[tid], @a5[tid]);

    delete(@nr[tid]); delete(@a0[tid]); delete(@a1[tid]); delete(@a2[tid]);
    delete(@a3[tid]); delete(@a4[tid]); delete(@a5[tid]);
}
